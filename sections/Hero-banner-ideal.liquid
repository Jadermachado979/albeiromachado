{% comment %}
  Hero Banner (Ideal) - Section with "arsenal" enhancements
  Author: ChatGPT (o3)
  Description: Highly customizable, accessible, performant hero/banner section that now integra tes analytics events, IntersectionObserver animations, and JSON‑LD structured data, mirroring the advanced capabilities of the original TXT.
  Version: 1.1 – May 01 2025
{% endcomment %}

<section
  class="hero-banner {% if section.settings.full_height %}hero-banner--full{% endif %}"
  role="banner"
  aria-label="{{ section.settings.heading | escape }} section"
  data-hero-banner-id="{{ section.id }}"
>
  {%- comment -%} Background media {%- endcomment -%}
  <div class="hero-banner__media" aria-hidden="true">
    {% if section.settings.bg_image != blank %}
      <img
        src="{{ section.settings.bg_image | img_url: '2048x' }}"
        alt=""
        class="hero-banner__img"
        loading="lazy"
        fetchpriority="high"
      >
    {% else %}
      <div class="hero-banner__placeholder"></div>
    {% endif %}
  </div>

  {%- comment -%} Color overlay {%- endcomment -%}
  <div
    class="hero-banner__overlay"
    style="background-color: {{ section.settings.overlay_color }}; opacity: {{ section.settings.overlay_opacity | divided_by: 100 }};">
  </div>

  {%- comment -%} Copy + CTA {%- endcomment -%}
  <div class="hero-banner__content hero-banner__content--{{ section.settings.content_alignment }} fade-in">
    <h1 class="hero-banner__title h0">{{ section.settings.heading }}</h1>

    {% unless section.settings.subheading == blank %}
      <p class="hero-banner__subtitle">{{ section.settings.subheading }}</p>
    {% endunless %}

    {% if section.blocks.size > 0 %}
      {% for block in section.blocks %}
        {% if block.type == 'cta_button' and block.settings.label != blank %}
          <a
            href="{{ block.settings.url }}"
            class="button button--primary"
            role="button"
            data-hero-cta
          >{{ block.settings.label }}</a>
        {% endif %}
      {% endfor %}
    {% elsif section.settings.cta_label != blank %}
      <a
        href="{{ section.settings.cta_url }}"
        class="button button--primary"
        role="button"
        data-hero-cta
      >{{ section.settings.cta_label }}</a>
    {% endif %}
  </div>

  {%- comment -%} Structured data for SEO {%- endcomment -%}
  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebPage",
      "name": {{ section.settings.heading | json }},
      "description": {{ section.settings.subheading | json }},
      "url": "{{ canonical_url | default: shop.url }}"
    }
  </script>
</section>

<style>
  /* --- HERO BANNER BASE --- */
  .hero-banner {position:relative;width:100%;overflow:hidden;display:flex;align-items:center;justify-content:center;text-align:center;color:var(--color-foreground,#ffffff);} 
  .hero-banner--full{min-height:100vh;} 
  .hero-banner__media{position:absolute;inset:0;z-index:1;} 
  .hero-banner__img,.hero-banner__placeholder{width:100%;height:100%;object-fit:cover;object-position:center;} 
  .hero-banner__placeholder{background:var(--color-placeholder,#dfe4e8);} 
  .hero-banner__overlay{position:absolute;inset:0;z-index:2;} 
  .hero-banner__content{position:relative;z-index:3;max-width:900px;padding:3rem 1.5rem;display:flex;flex-direction:column;gap:1.5rem;opacity:0;transform:translateY(40px);transition:opacity .6s ease,transform .6s ease;} 
  .hero-banner.is-visible .hero-banner__content{opacity:1;transform:none;} 
  .hero-banner__content--left{text-align:left;align-items:flex-start;} 
  .hero-banner__content--right{text-align:right;align-items:flex-end;} 
  .hero-banner__title{margin:0;font-size:calc(var(--font-size-h0,48px));line-height:1.1;font-weight:700;} 
  .hero-banner__subtitle{margin:0;font-size:calc(var(--font-size-body,18px));line-height:1.4;opacity:.9;} 
  .button{display:inline-block;padding:.85em 2.2em;font-weight:600;text-decoration:none;border-radius:var(--radius-md,6px);transition:background .25s ease;} 
  .button--primary{background:var(--color-accent,#ff6b2c);color:#fff;} 
  .button--primary:hover{background:var(--color-accent-dark,#d4551f);} 
  @media(max-width:767px){.hero-banner__title{font-size:32px;}.hero-banner__subtitle{font-size:16px;}}
</style>

<script>
  /* Hero banner analytics & reveal */
  window.dataLayer = window.dataLayer || [];
  document.addEventListener('DOMContentLoaded',function(){
    const hero=document.querySelector('[data-hero-banner-id="{{ section.id }}"]');
    if(!hero) return;

    /* IntersectionObserver to reveal content & fire view event */
    const io=new IntersectionObserver(entries=>{
      entries.forEach(entry=>{
        if(entry.isIntersecting){
          hero.classList.add('is-visible');
          window.dataLayer.push({
            event:'hero_view',
            hero_id:'{{ section.id }}',
            hero_title:'{{ section.settings.heading | escape }}'
          });
          io.unobserve(hero);
        }
      });
    },{threshold:0.5});

    io.observe(hero);

    /* CTA click events */
    hero.querySelectorAll('[data-hero-cta]').forEach(btn=>{
      btn.addEventListener('click',()=>{
        window.dataLayer.push({
          event:'hero_click',
          hero_id:'{{ section.id }}',
          hero_title:'{{ section.settings.heading | escape }}',
          cta_label:btn.textContent.trim()
        });
      });
    });
  });
</script>

{% schema %}
{
  "name": "Hero banner (Ideal)",
  "tag": "section",
  "class": "section-hero-banner",
  "settings": [
    {"type": "image_picker", "id": "bg_image", "label": "Imagen de fondo"},
    {"type": "text", "id": "heading", "label": "Título", "default": "Título atractivo"},
    {"type": "textarea", "id": "subheading", "label": "Subtítulo", "default": "Texto envolvente que genera interés."},
    {"type": "color", "id": "overlay_color", "label": "Color de superposición", "default": "#000000"},
    {"type": "range", "id": "overlay_opacity", "label": "Opacidad de superposición (%)", "min": 0, "max": 100, "step": 5, "default": 35},
    {"type": "text", "id": "cta_label", "label": "Texto del botón", "default": "Comprar ahora"},
    {"type": "url", "id": "cta_url", "label": "Enlace del botón"},
    {"type": "select", "id": "content_alignment", "label": "Alineación del contenido", "default": "center", "options": [
      {"value": "left", "label": "Izquierda"},
      {"value": "center", "label": "Centro"},
      {"value": "right", "label": "Derecha"}
    ]},
    {"type": "checkbox", "id": "full_height", "label": "Banner altura completa", "default": true}
  ],
  "blocks": [
    {
      "type": "cta_button",
      "name": "Botón CTA adicional",
      "limit": 1,
      "settings": [
        {"type": "text", "id": "label", "label": "Texto", "default": "Descubrir"},
        {"type": "url", "id": "url", "label": "Enlace"}
      ]
    }
  ],
  "presets": [
    {"name": "Banner ideal (con arsenal)", "category": "Banners"}
  ]
}
{% endschema %}

{% stylesheet %}
  /* Scoped (if your theme supports) */
{% endstylesheet %}

